---
- name: Get leapp actors main repository
  git:
      repo: "{{ actors.git.repo }}"
      dest: "{{ actors.git.dest }}"
      version: "{{ actors.git.version }}"

- name: Install packages required by some actors on Fedora, if necessary
  become: true
  dnf:
      name: "{{ item }}"
      state: present
  with_items: "{{ actors.packages }}"
  when: ansible_distribution == 'Fedora'

- name: Install packages required by some actors on CentOS, if necessary
  become: true
  yum:
      name: "{{ item }}"
      state: present
  with_items: "{{ actors.packages }}"
  when: ansible_distribution == 'CentOS'

- name: "Install Leapp-Actors dependencies"
  become: true
  shell: "cd {{ actors.git.dest }} && make install-deps"

- name: "build Leapp-Actors"
  shell: "cd {{ actors.git.dest }} && make build"

- name: "Install Leapp-Actors"
  become: true
  shell: "cd {{ actors.git.dest }} && make install"

- name: Add actors_dir to snactor conf file
  lineinfile:
      path: "{{ snactor.conf.file }}"
      regexp: "^actors_dir:"
      line: "actors_dir: {{ actors.paths.actors }}"

- name: Add schemas_dir to snactor conf file
  lineinfile:
      path: "{{ snactor.conf.file }}"
      regexp: "^schemas_dir:"
      line: "schemas_dir: {{ actors.paths.schemas }}"
